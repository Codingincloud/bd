\chapter{SYSTEM DESIGN}

\section{System Architecture}

BDIMS follows a three-tier architecture pattern consisting of presentation, application, and data tiers.

\subsection{Architecture Overview}

\begin{itemize}
    \item \textbf{Presentation Tier:} HTML, CSS, JavaScript providing the user interface
    \item \textbf{Application Tier:} Django framework implementing business logic
    \item \textbf{Data Tier:} PostgreSQL database for persistent storage
\end{itemize}

\subsection{Django MVT Pattern}

BDIMS implements Django's Model-View-Template (MVT) architectural pattern:

\begin{itemize}
    \item \textbf{Model:} Defines data structure and database schema
    \item \textbf{View:} Contains business logic and request handling
    \item \textbf{Template:} Renders HTML with dynamic content
\end{itemize}

% Uncomment when you have the image
% \begin{figure}[h]
% \centering
% \includegraphics[width=0.8\textwidth]{images/architecture.png}
% \caption{System Architecture Diagram}
% \end{figure}

\section{Database Design}

\subsection{Entity Relationship Diagram}

The database consists of several interconnected entities representing donors, administrators, donations, inventory, and emergency requests.

% Uncomment when you have the image
% \begin{figure}[h]
% \centering
% \includegraphics[width=\textwidth]{images/er_diagram.png}
% \caption{Entity Relationship Diagram}
% \end{figure}

\subsection{Database Schema}

\subsubsection{User Table}
Django's built-in User model extended with custom profiles:
\begin{itemize}
    \item id (Primary Key)
    \item username (Unique)
    \item email
    \item password (Hashed)
    \item first\_name
    \item last\_name
    \item is\_staff (Boolean)
    \item is\_active (Boolean)
\end{itemize}

\subsubsection{Donor Table}
\begin{itemize}
    \item id (Primary Key)
    \item user\_id (Foreign Key to User)
    \item blood\_group
    \item date\_of\_birth
    \item gender
    \item phone\_number
    \item address
    \item city
    \item latitude
    \item longitude
    \item last\_donation\_date
    \item is\_eligible (Computed)
\end{itemize}

\subsubsection{HealthMetrics Table}
\begin{itemize}
    \item id (Primary Key)
    \item donor\_id (Foreign Key to Donor)
    \item weight
    \item blood\_pressure\_systolic
    \item blood\_pressure\_diastolic
    \item hemoglobin\_level
    \item recorded\_at (Timestamp)
\end{itemize}

\subsubsection{Hospital Table}
\begin{itemize}
    \item id (Primary Key)
    \item admin\_user\_id (OneToOne to User)
    \item name
    \item phone
    \item email
    \item address
    \item city
    \item hospital\_type
    \item operating\_hours
\end{itemize}

\subsubsection{BloodInventory Table}
\begin{itemize}
    \item id (Primary Key)
    \item hospital\_id (Foreign Key to Hospital)
    \item blood\_group
    \item units\_available
    \item units\_reserved
    \item last\_updated (Timestamp)
\end{itemize}

\subsubsection{DonationRequest Table}
\begin{itemize}
    \item id (Primary Key)
    \item donor\_id (Foreign Key to Donor)
    \item hospital\_id (Foreign Key to Hospital)
    \item requested\_date
    \item status (Pending/Approved/Rejected/Completed)
    \item notes
    \item created\_at (Timestamp)
\end{itemize}

\subsubsection{DonationHistory Table}
\begin{itemize}
    \item id (Primary Key)
    \item donor\_id (Foreign Key to Donor)
    \item donation\_date
    \item blood\_group
    \item units\_donated
    \item hospital\_name
    \item remarks
\end{itemize}

\subsubsection{EmergencyRequest Table}
\begin{itemize}
    \item id (Primary Key)
    \item hospital\_id (Foreign Key to Hospital)
    \item blood\_group
    \item units\_needed
    \item patient\_name
    \item urgency\_level
    \item status (Active/Fulfilled/Cancelled)
    \item created\_at (Timestamp)
\end{itemize}

\subsection{Database Relationships}

\begin{itemize}
    \item User has OneToOne relationship with Donor or AdminProfile
    \item Hospital has OneToOne relationship with User (admin)
    \item Donor has OneToMany relationship with HealthMetrics
    \item Donor has OneToMany relationship with DonationHistory
    \item Hospital has OneToMany relationship with BloodInventory
    \item Hospital has OneToMany relationship with DonationRequest
    \item Donor has OneToMany relationship with DonationRequest
\end{itemize}

\section{Module Design}

\subsection{Authentication Module}

\textbf{Purpose:} Handle user registration, login, and logout

\textbf{Components:}
\begin{itemize}
    \item Registration form with role selection (Donor/Admin)
    \item Login form with username/password authentication
    \item Password hashing using Django's default hasher
    \item Session management
\end{itemize}

\textbf{Functions:}
\begin{lstlisting}[language=Python]
def register_view(request):
    # Handle donor and admin registration
    # Create User object
    # Create associated profile
    # Redirect to appropriate dashboard

def login_view(request):
    # Authenticate user
    # Create session
    # Redirect based on role

def logout_view(request):
    # Clear session
    # Redirect to home page
\end{lstlisting}

\subsection{Donor Management Module}

\textbf{Purpose:} Manage donor information and profiles

\textbf{Components:}
\begin{itemize}
    \item Donor dashboard with statistics
    \item Profile update form
    \item Health metrics recording
    \item Donation history display
    \item Location update with interactive map
\end{itemize}

\textbf{Key Functions:}
\begin{lstlisting}[language=Python]
def donor_dashboard(request):
    # Display donor statistics
    # Show recent donations
    # Display eligibility status

def update_profile(request):
    # Update donor information
    # Validate data
    # Save to database

def add_health_metrics(request):
    # Record health metrics
    # Validate ranges
    # Store with timestamp

def update_location(request):
    # Get latitude/longitude
    # Reverse geocode to address
    # Update donor location
\end{lstlisting}

\subsection{Donation Management Module}

\textbf{Purpose:} Handle donation requests and scheduling

\textbf{Components:}
\begin{itemize}
    \item Donation request form
    \item Request approval interface
    \item Eligibility verification
    \item Status tracking
\end{itemize}

\textbf{Key Functions:}
\begin{lstlisting}[language=Python]
def schedule_donation(request):
    # Check donor eligibility
    # Create donation request
    # Notify administrator

def approve_request(request, request_id):
    # Verify eligibility again
    # Update request status
    # Notify donor

def complete_donation(request, request_id):
    # Record donation in history
    # Update last donation date
    # Update blood inventory
\end{lstlisting}

\subsection{Inventory Management Module}

\textbf{Purpose:} Track blood inventory levels

\textbf{Components:}
\begin{itemize}
    \item Inventory dashboard with stock levels
    \item Stock update interface
    \item Low stock alerts
    \item Blood type filtering
\end{itemize}

\textbf{Key Functions:}
\begin{lstlisting}[language=Python]
def manage_inventory(request):
    # Display current stock
    # Show by blood type
    # Highlight low stock

def update_inventory(request):
    # Update units available
    # Validate quantities
    # Record timestamp

def check_availability(blood_group, units):
    # Query inventory
    # Return availability status
\end{lstlisting}

\subsection{Emergency Management Module}

\textbf{Purpose:} Handle urgent blood requests

\textbf{Components:}
\begin{itemize}
    \item Emergency request creation form
    \item Donor matching algorithm
    \item Notification system
    \item Request tracking
\end{itemize}

\textbf{Key Functions:}
\begin{lstlisting}[language=Python]
def create_emergency_request(request):
    # Create emergency request
    # Match eligible donors
    # Send notifications

def match_donors(blood_group, location):
    # Query eligible donors
    # Filter by blood type
    # Sort by distance
    # Return matched donors

def notify_donors(donor_list, request_details):
    # Send emergency notifications
    # Log notification attempts
\end{lstlisting}

\section{Interface Design}

\subsection{User Interface Principles}

The UI design follows these principles:
\begin{itemize}
    \item \textbf{Simplicity:} Clean, uncluttered layouts
    \item \textbf{Consistency:} Uniform design across pages
    \item \textbf{Responsiveness:} Adapts to different screen sizes
    \item \textbf{Accessibility:} Clear labels and error messages
    \item \textbf{Feedback:} Visual confirmation of actions
\end{itemize}

\subsection{Key Interfaces}

\subsubsection{Login Page}
\begin{itemize}
    \item Simple form with username and password
    \item Role selection (Donor/Admin)
    \item Links to registration and password recovery
\end{itemize}

\subsubsection{Donor Dashboard}
\begin{itemize}
    \item Overview cards showing statistics
    \item Quick action buttons
    \item Recent donation history
    \item Eligibility status indicator
    \item Navigation menu
\end{itemize}

\subsubsection{Admin Dashboard}
\begin{itemize}
    \item System-wide statistics
    \item Pending requests count
    \item Blood inventory overview
    \item Quick access to management functions
\end{itemize}

\subsubsection{Donation Request Form}
\begin{itemize}
    \item Hospital selection dropdown
    \item Preferred date picker
    \item Notes textarea
    \item Eligibility check before submission
\end{itemize}

\subsubsection{Interactive Map Interface}
\begin{itemize}
    \item Leaflet map with marker
    \item Click-to-place marker
    \item Search box for location lookup
    \item Current location button
    \item Address display
\end{itemize}

% Uncomment when you have the images
% \begin{figure}[h]
% \centering
% \includegraphics[width=\textwidth]{images/donor_dashboard.png}
% \caption{Donor Dashboard Interface}
% \end{figure}

\section{Security Design}

\subsection{Authentication and Authorization}

\begin{itemize}
    \item Django's built-in authentication system
    \item Password hashing using PBKDF2 algorithm
    \item Session-based authentication
    \item Role-based access control using Django decorators
\end{itemize}

\subsection{Data Protection}

\begin{itemize}
    \item HTTPS for data transmission (in production)
    \item CSRF token protection on all forms
    \item SQL injection prevention through ORM
    \item XSS protection with template escaping
\end{itemize}

\subsection{Access Control}

\begin{itemize}
    \item Login required decorators on protected views
    \item Role checking middleware
    \item Permission-based feature access
    \item Audit logging for sensitive operations
\end{itemize}

\section{Algorithm Design}

\subsection{Eligibility Calculation Algorithm}

\begin{lstlisting}[language=Python]
def calculate_eligibility(donor):
    """
    Calculate if donor is eligible to donate
    Returns: (is_eligible, reason)
    """
    # Check last donation date
    if donor.last_donation_date:
        days_since_last = (today - donor.last_donation_date).days
        if days_since_last < 56:
            return False, "Must wait 56 days between donations"
    
    # Check age
    age = calculate_age(donor.date_of_birth)
    if age < 18 or age > 65:
        return False, "Age must be between 18-65"
    
    # Check latest health metrics
    latest_metrics = donor.health_metrics.latest()
    
    if latest_metrics.weight < 50:
        return False, "Weight must be at least 50 kg"
    
    if latest_metrics.hemoglobin_level < 12.5:
        return False, "Hemoglobin level too low"
    
    # All checks passed
    return True, "Eligible to donate"
\end{lstlisting}

\subsection{Donor Matching Algorithm}

\begin{lstlisting}[language=Python]
def match_donors_for_emergency(blood_group, hospital_location):
    """
    Match eligible donors for emergency request
    Returns: List of matched donors sorted by distance
    """
    # Get compatible blood types
    compatible_types = get_compatible_blood_types(blood_group)
    
    # Query eligible donors with compatible blood
    eligible_donors = Donor.objects.filter(
        blood_group__in=compatible_types,
        is_active=True
    )
    
    # Filter by eligibility
    matched_donors = []
    for donor in eligible_donors:
        is_eligible, _ = calculate_eligibility(donor)
        if is_eligible:
            # Calculate distance
            distance = calculate_distance(
                donor.latitude, donor.longitude,
                hospital_location.latitude, hospital_location.longitude
            )
            matched_donors.append((donor, distance))
    
    # Sort by distance
    matched_donors.sort(key=lambda x: x[1])
    
    return [donor for donor, _ in matched_donors[:20]]
\end{lstlisting}
