{% extends 'admin_panel/base_admin.html' %}

{% block title %}Admin Dashboard | Blood Donor Information Management System{% endblock %}

{% block extra_css %}
    <style>
        .welcome-section {
            background: linear-gradient(135deg, #c62828 0%, #b71c1c 100%);
            color: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
            box-shadow: var(--shadow-lg);
        }

        .welcome-section h1 {
            font-size: var(--text-3xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .welcome-section p {
            font-size: var(--text-lg);
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

    .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

    .action-card {
            background: white;
        padding: var(--space-8);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        border: 2px solid transparent;
    }

    .action-card:hover {
        transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        text-decoration: none;
        color: inherit;
        border-color: var(--color-primary-600);
    }

    .action-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-700));
        color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        font-size: var(--text-3xl);
        margin: 0 auto var(--space-6);
    }

    .action-title {
        font-weight: 600;
            color: var(--color-gray-900);
        margin-bottom: var(--space-2);
        font-size: var(--text-xl);
        }

    .action-description {
            color: var(--color-gray-600);
            font-size: var(--text-sm);
        line-height: 1.5;
        font-weight: 500;
    }

    .recent-activities {
            background: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--color-gray-800);
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-primary-600);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-base);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
            font-size: var(--text-base);
        }

        .activity-description {
            color: var(--color-gray-600);
            font-size: var(--text-sm);
        }

        .activity-time {
            color: var(--color-gray-500);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .stat-number {
            font-size: var(--text-4xl);
            font-weight: 700;
            color: var(--color-primary-700);
            margin-bottom: var(--space-2);
            line-height: 1.2;
        }

        .stat-label {
            color: var(--color-gray-700);
            font-weight: 600;
            font-size: var(--text-base);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
{% endblock %}



{% block content %}
        <!-- Welcome Section -->
        <div class="welcome-section fade-in-up">
            <h1>Admin Dashboard</h1>
    <p>Welcome back, {{ user.get_full_name|default:user.username }}! Manage your blood donation system efficiently.</p>
        </div>

<!-- Stats Overview -->
        <div class="stats-grid fade-in-up">
    <div class="stat-card">
        <div class="stat-number">{{ total_donors|default:"0" }}</div>
                <div class="stat-label">Total Donors</div>
            </div>
    <div class="stat-card">
        <div class="stat-number">{{ active_donors|default:"0" }}</div>
        <div class="stat-label">Active Donors</div>
                    </div>
    <div class="stat-card">
        <div class="stat-number">{{ pending_requests|default:"0" }}</div>
        <div class="stat-label">Pending Requests</div>
                </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_donations|default:"0" }}</div>
                <div class="stat-label">Total Donations</div>
            </div>
        </div>

        <!-- Blood Group Distribution Chart -->
        <div class="dashboard-section fade-in-up" style="margin-bottom: var(--space-8);">
            <div class="section-header" style="background: white; padding: var(--space-4); border-radius: var(--radius-lg) var(--radius-lg) 0 0; border-bottom: 2px solid var(--color-gray-100);">
                <h3 style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-gray-800); font-size: var(--text-xl); font-weight: 600; margin: 0;">
                    <i class="fas fa-chart-pie" style="color: var(--admin-primary-600);"></i>
                    Blood Group Distribution
                </h3>
            </div>
            <div class="chart-container" style="background: white; padding: var(--space-6); border-radius: 0 0 var(--radius-lg) var(--radius-lg); box-shadow: var(--shadow-md);">
                <canvas id="bloodGroupChart" style="max-height: 350px;"></canvas>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions fade-in-up">
    <a href="{% url 'admin_panel:donor_tracking' %}" class="action-card">
        <div class="action-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="action-title">Track Donor</div>
        <div class="action-description">View and manage donor profiles, search by blood group or location</div>
    </a>

            <a href="{% url 'admin_panel:manage_requests' %}" class="action-card">
                <div class="action-icon">
            <i class="fas fa-clipboard-list"></i>
                </div>
        <div class="action-title">Manage Requests</div>
        <div class="action-description">Review and approve donation requests from donors</div>
    </a>

    <a href="{% url 'admin_panel:create_emergency_request' %}" class="action-card" style="border: 2px solid var(--color-danger-600); background: linear-gradient(135deg, rgba(220, 38, 38, 0.05), rgba(220, 38, 38, 0.1));">
        <div class="action-icon" style="background: var(--color-danger-600);">
            <i class="fas fa-plus-circle"></i>
        </div>
        <div class="action-title" style="color: var(--color-danger-600);">Create Emergency Request</div>
        <div class="action-description">Quickly create urgent blood request and notify donors</div>
    </a>

    <a href="{% url 'admin_panel:manage_emergencies' %}" class="action-card">
        <div class="action-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="action-title">Manage Emergencies</div>
        <div class="action-description">View and handle existing emergency blood requests</div>
    </a>

            <a href="{% url 'admin_panel:reports' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="action-title">View Reports</div>
        <div class="action-description">Access system analytics, blood group distribution, and statistics</div>
    </a>

    <a href="{% url 'admin_panel:manage_inventory' %}" class="action-card">
        <div class="action-icon">
            <i class="fas fa-tint"></i>
        </div>
        <div class="action-title">Blood Inventory</div>
        <div class="action-description">Monitor blood stock levels and manage inventory</div>
    </a>

    <a href="{% url 'admin_panel:my_hospital' %}" class="action-card" style="border: 2px solid var(--color-info-600);">
        <div class="action-icon" style="background: var(--color-info-600);">
            <i class="fas fa-hospital"></i>
        </div>
        <div class="action-title">My Hospital</div>
        <div class="action-description">View and manage your hospital details</div>
    </a>

    <a href="{% url 'admin_panel:admin_profile' %}" class="action-card">
        <div class="action-icon">
            <i class="fas fa-user-shield"></i>
        </div>
        <div class="action-title">View Profile</div>
        <div class="action-description">View your admin profile and account information</div>
    </a>

    <a href="{% url 'admin_panel:edit_admin_profile' %}" class="action-card">
        <div class="action-icon">
            <i class="fas fa-user-edit"></i>
        </div>
        <div class="action-title">Edit Profile</div>
        <div class="action-description">Update your admin profile and account settings</div>
    </a>
</div>

<!-- Recent Activities -->
<div class="recent-activities fade-in-up">
    <h2 class="section-title">
        <i class="fas fa-history"></i>
        Recent System Activities
    </h2>
    <ul class="activity-list">
        {% if recent_activities %}
            {% for activity in recent_activities %}
            <li class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-{{ activity.icon|default:'info-circle' }}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ activity.title }}</div>
                    <div class="activity-description">{{ activity.description }}</div>
                </div>
                <div class="activity-time">{{ activity.time|default:"Just now" }}</div>
            </li>
            {% endfor %}
        {% else %}
            <li class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">System Ready</div>
                    <div class="activity-description">Blood Donation Management System is running smoothly</div>
                </div>
                <div class="activity-time">Just now</div>
            </li>
        {% endif %}
    </ul>
</div>
{% endblock %}

{% block extra_js %}
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        // Blood Group Distribution Chart
        const ctx = document.getElementById('bloodGroupChart');
        
        // Blood group data from backend
        const bloodGroupLabels = [
            {% for label in blood_group_labels %}'{{ label }}'{% if not forloop.last %}, {% endif %}{% endfor %}
        ];
        
        const bloodGroupCounts = [
            {% for count in blood_group_counts %}{{ count }}{% if not forloop.last %}, {% endif %}{% endfor %}
        ];
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: bloodGroupLabels,
                datasets: [{
                    label: 'Donors',
                    data: bloodGroupCounts,
                    backgroundColor: [
                        '#2563eb', // A+ - Blue
                        '#60a5fa', // A- - Light Blue
                        '#16a34a', // B+ - Green
                        '#4ade80', // B- - Light Green
                        '#dc2626', // AB+ - Red
                        '#f87171', // AB- - Light Red
                        '#ea580c', // O+ - Orange
                        '#fb923c'  // O- - Light Orange
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 3,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'right',
                        labels: {
                            font: {
                                size: 14,
                                weight: 600
                            },
                            color: '#374151',
                            padding: 15,
                            generateLabels: function(chart) {
                                const data = chart.data;
                                return data.labels.map((label, i) => {
                                    const value = data.datasets[0].data[i];
                                    return {
                                        text: `${label}: ${value} donor${value !== 1 ? 's' : ''}`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        hidden: false,
                                        index: i
                                    };
                                });
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                return `${context.label}: ${context.parsed} donor${context.parsed !== 1 ? 's' : ''} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
        
        // Add smooth animations
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.fade-in-up');
            elements.forEach((element, index) => {
                element.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Add hover effects to action cards
        document.querySelectorAll('.action-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
{% endblock %}