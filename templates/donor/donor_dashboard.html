{% extends 'donor/base_donor.html' %}

{% block title %}Donor Dashboard | Blood Donor Information Management System{% endblock %}

{% block extra_css %}
<style>
        .welcome-section {
            background: linear-gradient(135deg, #c62828 0%, #b71c1c 100%);
            color: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
            box-shadow: var(--shadow-lg);
        }

        .welcome-section h1 {
            font-size: var(--text-3xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .welcome-section p {
            font-size: var(--text-lg);
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--color-primary-600);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .stat-card.donations {
            border-left-color: var(--color-accent-600);
        }

        .stat-card.eligibility {
            border-left-color: var(--color-info-600);
        }

        .stat-card.next-donation {
            border-left-color: var(--color-secondary-600);
        }

        .stat-card.emergencies {
            border-left-color: var(--color-danger-600);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-2xl);
            color: white;
        }

        .stat-icon.donations {
            background: var(--color-accent-600);
        }

        .stat-icon.eligibility {
            background: var(--color-info-600);
        }

        .stat-icon.next-donation {
            background: var(--color-secondary-600);
        }

        .stat-icon.emergencies {
            background: var(--color-danger-600);
        }

        .stat-value {
            font-size: var(--text-4xl);
            font-weight: 700;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
            line-height: 1.2;
            opacity: 1 !important;
        }

        .stat-label {
            color: var(--color-gray-800);
            font-weight: 700;
            font-size: var(--text-base);
            margin-bottom: var(--space-1);
            opacity: 1 !important;
        }

        .stat-description {
            font-size: var(--text-sm);
            color: var(--color-gray-700);
            margin-top: var(--space-2);
            opacity: 1 !important;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .action-card {
            background: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            text-decoration: none;
            color: inherit;
        }

        .action-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-700));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-3xl);
            margin: 0 auto var(--space-6);
        }

        .action-title {
            font-weight: 600;
            color: var(--color-gray-800);
            margin-bottom: var(--space-2);
            font-size: var(--text-xl);
        }

        .action-description {
            color: var(--color-gray-500);
            font-size: var(--text-sm);
            line-height: 1.5;
        }

        /* Emergency Alerts */
        .emergency-section {
            background: var(--color-danger-50);
            border: 2px solid var(--color-danger-600);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
        }

        .emergency-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .emergency-header i {
            color: var(--color-danger-600);
            font-size: var(--text-2xl);
        }

        .emergency-header h3 {
            color: var(--color-danger-600);
            font-weight: 700;
        }

        .emergency-item {
            background: white;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-2);
            border-left: 4px solid var(--color-danger-600);
        }

        .emergency-item:last-child {
            margin-bottom: 0;
        }

        .emergency-title {
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
            font-size: var(--text-base);
        }

        .emergency-details {
            color: var(--color-gray-700);
            font-size: var(--text-sm);
            font-weight: 500;
        }

        /* Recent Activities */
        .activities-section {
            background: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--color-gray-800);
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-primary-600);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-base);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
            font-size: var(--text-base);
        }

        .activity-description {
            color: var(--color-gray-600);
            font-size: var(--text-sm);
        }

        .activity-time {
            color: var(--color-gray-500);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-eligible {
            background: var(--color-success-50);
            color: var(--color-success-700);
        }

        .status-ineligible {
            background: var(--color-danger-50);
            color: var(--color-danger-700);
        }

        .status-pending {
            background: var(--color-warning-50);
            color: var(--color-warning-700);
        }
    </style>
{% endblock %}

{% block content %}
        <!-- Welcome Section -->
        <div class="welcome-section fade-in-up">
            <h1>Welcome back, {{ user.get_full_name|default:user.username }}!</h1>
            <p>Blood Type: <strong>{{ donor.blood_group }}</strong> ‚Ä¢ Last Donation: <strong>{{ donor.last_donation_date|date:"M d, Y"|default:"No donations yet" }}</strong></p>
        </div>

        <!-- Impact & Health Status Cards -->
        <div class="stats-grid fade-in-up">
            <div class="stat-card" style="border-left-color: var(--color-success-600);">
                <div class="stat-header">
                    <div class="stat-icon" style="background: var(--color-success-600);">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="stat-value">~{{ lives_helped }}</div>
                <div class="stat-label">Lives Potentially Helped</div>
                <div class="stat-description">Each donation can help up to 3 patients</div>
            </div>

            <div class="stat-card donations">
                <div class="stat-header">
                    <div class="stat-icon donations">
                        <i class="fas fa-tint"></i>
                    </div>
                </div>
                <div class="stat-value">{{ total_donations|default:"0" }}</div>
                <div class="stat-label">Total Donations</div>
                <div class="stat-description">{{ total_units_donated|default:"0" }} units donated</div>
            </div>

            <div class="stat-card eligibility">
                <div class="stat-header">
                    <div class="stat-icon eligibility">
                        <i class="fas fa-{% if can_donate %}check-circle{% else %}clock{% endif %}"></i>
                    </div>
                </div>
                <div class="stat-value">
                    {% if can_donate %}
                        <span class="status-badge status-eligible">‚úì Eligible</span>
                    {% else %}
                        <span class="status-badge status-ineligible">{{ days_until_eligible|default:"--" }} days</span>
                    {% endif %}
                </div>
                <div class="stat-label">Donation Status</div>
                <div class="stat-description">
                    {% if can_donate %}
                        You can donate now!
                    {% else %}
                        Next eligible: {{ next_eligible_date|date:"M d, Y" }}
                    {% endif %}
                </div>
            </div>

            <div class="stat-card emergencies">
                <div class="stat-header">
                    <div class="stat-icon emergencies">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="stat-value">{{ emergency_requests|length|default:"0" }}</div>
                <div class="stat-label">Active Emergencies</div>
                <div class="stat-description">Urgent requests for {{ donor.blood_group }}</div>
            </div>
        </div>

        <!-- Health Metrics Section -->
        <div class="fade-in-up" style="background: white; padding: var(--space-6); border-radius: var(--radius-xl); box-shadow: var(--shadow-md); margin-bottom: var(--space-8);">
            <h3 style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-gray-800); font-size: var(--text-xl); font-weight: 600; margin-bottom: var(--space-4);">
                <i class="fas fa-heartbeat" style="color: var(--color-primary-600);"></i>
                Your Health Metrics
            </h3>
            {% if latest_health_metrics %}
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4);">
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: var(--text-sm); color: var(--color-gray-700); font-weight: 600; margin-bottom: var(--space-1);">Hemoglobin</div>
                    <div style="font-size: var(--text-2xl); font-weight: 700; color: {% if latest_health_metrics.hemoglobin_level >= 12.5 %}var(--color-success-600){% else %}var(--color-warning-600){% endif %}; opacity: 1;">
                        {{ latest_health_metrics.hemoglobin_level|default:"N/A" }} {% if latest_health_metrics.hemoglobin_level %}g/dL{% endif %}
                    </div>
                    <div style="font-size: var(--text-xs); color: var(--color-gray-600); font-weight: 500; margin-top: var(--space-1); opacity: 1;">
                        {% if latest_health_metrics.hemoglobin_level %}{% if latest_health_metrics.hemoglobin_level >= 12.5 %}‚úì Normal{% else %}‚ö† Low{% endif %}{% else %}No data{% endif %}
                    </div>
                </div>
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: var(--text-sm); color: var(--color-gray-700); font-weight: 600; margin-bottom: var(--space-1);">Blood Pressure</div>
                    <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-success-600); opacity: 1;">
                        {{ latest_health_metrics.blood_pressure_systolic|default:"N/A" }}{% if latest_health_metrics.blood_pressure_systolic %}/{{ latest_health_metrics.blood_pressure_diastolic }}{% endif %}
                    </div>
                    <div style="font-size: var(--text-xs); color: var(--color-gray-600); font-weight: 500; margin-top: var(--space-1); opacity: 1;">mmHg</div>
                </div>
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: var(--text-sm); color: var(--color-gray-700); font-weight: 600; margin-bottom: var(--space-1);">Weight</div>
                    <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--color-gray-900); opacity: 1;">
                        {{ donor.weight|default:"N/A" }} {% if donor.weight %}kg{% endif %}
                    </div>
                    <div style="font-size: var(--text-xs); color: var(--color-gray-600); font-weight: 500; margin-top: var(--space-1); opacity: 1;">
                        {% if donor.weight %}{% if donor.weight >= 50 %}‚úì Eligible{% else %}Below minimum{% endif %}{% else %}No data{% endif %}
                    </div>
                </div>
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: var(--text-sm); color: var(--color-gray-700); font-weight: 600; margin-bottom: var(--space-1);">Last Check</div>
                    <div style="font-size: var(--text-lg); font-weight: 600; color: var(--color-gray-900); opacity: 1;">
                        {{ latest_health_metrics.recorded_at|date:"M d, Y" }}
                    </div>
                    <div style="font-size: var(--text-xs); color: var(--color-gray-600); font-weight: 500; margin-top: var(--space-1); opacity: 1;">{{ latest_health_metrics.recorded_at|timesince }} ago</div>
                </div>
            </div>
            <div style="margin-top: var(--space-4); text-align: center;">
                <a href="{% url 'donor:add_health_metrics' %}" style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-2) var(--space-4); background: var(--color-primary-600); color: white; border-radius: var(--radius-lg); text-decoration: none; font-size: var(--text-sm); font-weight: 600; transition: background 0.2s ease;">
                    <i class="fas fa-plus"></i> Update Health Metrics
                </a>
            </div>
            {% else %}
            <div style="text-align: center; padding: var(--space-8) var(--space-4);">
                <div style="width: 80px; height: 80px; margin: 0 auto var(--space-4); background: var(--color-gray-100); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-heartbeat" style="font-size: 2rem; color: var(--color-gray-400);"></i>
                </div>
                <h4 style="color: var(--color-gray-700); font-size: var(--text-lg); font-weight: 600; margin-bottom: var(--space-2);">No Health Metrics Recorded</h4>
                <p style="color: var(--color-gray-500); font-size: var(--text-sm); margin-bottom: var(--space-6); max-width: 400px; margin-left: auto; margin-right: auto;">
                    Track your health metrics to monitor your donation eligibility and ensure safe blood donation.
                </p>
                <a href="{% url 'donor:add_health_metrics' %}" style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-3) var(--space-6); background: var(--color-primary-600); color: white; border-radius: var(--radius-lg); text-decoration: none; font-size: var(--text-base); font-weight: 600; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0, 0, 0, 0.1)';">
                    <i class="fas fa-plus-circle"></i> Add Your First Health Metrics
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Pre-Donation Checklist (only if eligible soon) -->
        {% if can_donate or days_until_eligible <= 7 %}
        <div class="fade-in-up" style="background: linear-gradient(135deg, var(--color-info-50), var(--color-info-100)); border: 2px solid var(--color-info-600); padding: var(--space-6); border-radius: var(--radius-xl); margin-bottom: var(--space-8);">
            <h3 style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-info-700); font-size: var(--text-xl); font-weight: 600; margin-bottom: var(--space-4);">
                <i class="fas fa-clipboard-check"></i>
                Pre-Donation Checklist
            </h3>
            <div style="background: white; padding: var(--space-4); border-radius: var(--radius-lg);">
                <p style="color: var(--color-gray-700); margin-bottom: var(--space-4); font-weight: 500;">Before your next donation, make sure to:</p>
                <div style="display: grid; gap: var(--space-3);">
                    <div style="display: flex; align-items: start; gap: var(--space-2);">
                        <div style="width: 24px; height: 24px; background: var(--color-success-600); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0;">‚úì</div>
                        <div>
                            <div style="font-weight: 600; color: var(--color-gray-900);">Get adequate sleep</div>
                            <div style="font-size: var(--text-sm); color: var(--color-gray-600);">7-8 hours of rest the night before</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: var(--space-2);">
                        <div style="width: 24px; height: 24px; background: var(--color-success-600); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0;">‚úì</div>
                        <div>
                            <div style="font-weight: 600; color: var(--color-gray-900);">Stay hydrated</div>
                            <div style="font-size: var(--text-sm); color: var(--color-gray-600);">Drink 16oz (500ml) of water before donating</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: var(--space-2);">
                        <div style="width: 24px; height: 24px; background: var(--color-success-600); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0;">‚úì</div>
                        <div>
                            <div style="font-weight: 600; color: var(--color-gray-900);">Eat a nutritious meal</div>
                            <div style="font-size: var(--text-sm); color: var(--color-gray-600);">Have a healthy meal 2-3 hours before donating</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: var(--space-2);">
                        <div style="width: 24px; height: 24px; background: var(--color-success-600); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0;">‚úì</div>
                        <div>
                            <div style="font-weight: 600; color: var(--color-gray-900);">Avoid alcohol</div>
                            <div style="font-size: var(--text-sm); color: var(--color-gray-600);">No alcohol for 24 hours before donation</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: var(--space-2);">
                        <div style="width: 24px; height: 24px; background: var(--color-success-600); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0;">‚úì</div>
                        <div>
                            <div style="font-weight: 600; color: var(--color-gray-900);">Bring identification</div>
                            <div style="font-size: var(--text-sm); color: var(--color-gray-600);">Valid ID card and donor card if available</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Educational Tips Section -->
        <div class="fade-in-up" style="background: white; padding: var(--space-6); border-radius: var(--radius-xl); box-shadow: var(--shadow-md); margin-bottom: var(--space-8);">
            <h3 style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-gray-800); font-size: var(--text-xl); font-weight: 600; margin-bottom: var(--space-4);">
                <i class="fas fa-lightbulb" style="color: var(--color-warning-600);"></i>
                Did You Know?
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-4);">
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg); border-left: 4px solid var(--color-primary-600);">
                    <div style="font-weight: 600; color: var(--color-gray-900); margin-bottom: var(--space-2);">ü©∏ Blood Cannot Be Manufactured</div>
                    <div style="font-size: var(--text-sm); color: var(--color-gray-600);">It must come from generous donors like you. There's no substitute for human blood.</div>
                </div>
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg); border-left: 4px solid var(--color-success-600);">
                    <div style="font-weight: 600; color: var(--color-gray-900); margin-bottom: var(--space-2);">‚ù§Ô∏è One Donation Saves Three Lives</div>
                    <div style="font-size: var(--text-sm); color: var(--color-gray-600);">Your single donation can be separated into components to help multiple patients.</div>
                </div>
                <div style="padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-lg); border-left: 4px solid var(--color-info-600);">
                    <div style="font-weight: 600; color: var(--color-gray-900); margin-bottom: var(--space-2);">‚è∞ Red Blood Cells Last 42 Days</div>
                    <div style="font-size: var(--text-sm); color: var(--color-gray-600);">Regular donations are needed to maintain adequate blood supply.</div>
                </div>
            </div>
        </div>

        <!-- Appointment Status Section -->
        <div class="stats-grid fade-in-up" style="margin-bottom: 2rem;">
            <div class="stat-card" style="border-left-color: var(--color-warning-600);">
                <div class="stat-content">
                    <div class="stat-icon" style="background: var(--color-warning-600);">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                <div class="stat-value">{{ pending_requests.count|default:"0" }}</div>
                <div class="stat-label">Pending Approval</div>
                <div class="stat-description">Awaiting admin approval</div>
            </div>

            <div class="stat-card" style="border-left-color: var(--color-info-600);">
                <div class="stat-content">
                    <div class="stat-icon" style="background: var(--color-info-600);">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="stat-value">{{ approved_requests.count|default:"0" }}</div>
                <div class="stat-label">Approved</div>
                <div class="stat-description">Ready for donation</div>
            </div>

            <div class="stat-card" style="border-left-color: var(--color-success-600);">
                <div class="stat-content">
                    <div class="stat-icon" style="background: var(--color-success-600);">
                        <i class="fas fa-check-double"></i>
                    </div>
                </div>
                <div class="stat-value">{{ total_completed_appointments|default:"0" }}</div>
                <div class="stat-label">Completed</div>
                <div class="stat-description">Successfully donated</div>
            </div>

            <div class="stat-card" style="border-left-color: var(--color-gray-400);">
                <div class="stat-content">
                    <div class="stat-icon" style="background: var(--color-gray-500);">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="stat-value">{{ cancelled_requests|add:rejected_requests|default:"0" }}</div>
                <div class="stat-label">Cancelled/Rejected</div>
                <div class="stat-description">Not completed</div>
            </div>
        </div>

        <!-- Approved Appointments Alert -->
        {% if approved_requests %}
        <div class="fade-in-up" style="background: var(--color-info-50); border: 2px solid var(--color-info-600); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
            <h3 style="color: var(--color-info-600); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-calendar-check"></i>
                You have {{ approved_requests.count }} approved appointment{{ approved_requests.count|pluralize }}!
            </h3>
            {% for request in approved_requests %}
            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid var(--color-info-600);">
                <div style="font-weight: 600; color: var(--color-gray-800); margin-bottom: 0.25rem;">
                    üìÖ {{ request.requested_date|date:"l, F d, Y" }} at {{ request.preferred_time }}
                </div>
                <div style="color: var(--color-gray-600); font-size: 0.875rem;">
                    Status: Approved ‚Ä¢ Please arrive on time to donate
                    {% if request.hospital %}<br>üìç {{ request.hospital.name }}, {{ request.hospital.city }}{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Emergency Alerts -->
        {% if emergency_requests %}
        <div class="emergency-section fade-in-up">
            <div class="emergency-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Urgent Blood Requests</h3>
            </div>
            {% for request in emergency_requests %}
            <div class="emergency-item">
                <div class="emergency-title">{{ request.hospital_name }} - {{ request.blood_group_needed }}</div>
                <div class="emergency-details">
                    {{ request.units_needed }} units needed ‚Ä¢ Contact: {{ request.contact_person }} ‚Ä¢ 
                    Required by: {{ request.required_by|date:"M d, Y H:i" }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Donation Activity Chart -->
        <div class="dashboard-section" style="margin-bottom: var(--space-8);">
            <div class="section-header" style="background: white; padding: var(--space-4); border-radius: var(--radius-lg) var(--radius-lg) 0 0; border-bottom: 2px solid var(--color-gray-100);">
                <h3 style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-gray-800); font-size: var(--text-xl); font-weight: 600; margin: 0;">
                    <i class="fas fa-chart-line" style="color: var(--color-primary-600);"></i>
                    Donation Activity (Last 6 Months)
                </h3>
            </div>
            <div class="chart-container" style="background: white; padding: var(--space-6); border-radius: 0 0 var(--radius-lg) var(--radius-lg); box-shadow: var(--shadow-md);">
                <canvas id="donationTrendsChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions fade-in-up">
            <a href="{% url 'donor:schedule_donation' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <div class="action-title">Schedule Donation</div>
                <div class="action-description">Book your next blood donation appointment at a convenient time and location</div>
            </a>

            <a href="{% url 'donor:donation_history' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-history"></i>
                </div>
                <div class="action-title">View History</div>
                <div class="action-description">Track your donation history and see your impact on saving lives</div>
            </a>

            <a href="{% url 'donor:donation_centers' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-hospital"></i>
                </div>
                <div class="action-title">Find Centers</div>
                <div class="action-description">Locate nearby blood donation centers and check their availability</div>
            </a>

            <a href="{% url 'donor:emergency_requests' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="action-title">Emergency Requests</div>
                <div class="action-description">View urgent blood requests and help save lives in critical situations</div>
            </a>

            <a href="{% url 'donor:compatibility_check' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-search"></i>
                </div>
                <div class="action-title">Compatibility Check</div>
                <div class="action-description">Check blood type compatibility and find compatible donors</div>
            </a>

            <a href="{% url 'donor:medical_reports' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-file-medical"></i>
                </div>
                <div class="action-title">Medical Reports</div>
                <div class="action-description">Upload and manage your medical reports and health metrics</div>
            </a>
        </div>

        <!-- Recent Activities -->
        <div class="activities-section fade-in-up">
            <h2 class="section-title">
                <i class="fas fa-history"></i>
                Recent Activities
            </h2>
            <ul class="activity-list">
                {% if recent_donations %}
                    {% for donation in recent_donations %}
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Donation Completed</div>
                            <div class="activity-description">Donated {{ donation.units_donated }} units of {{ donation.donor.blood_group }} blood at {{ donation.donation_center_name|default:"Main Center" }}</div>
                        </div>
                        <div class="activity-time">{{ donation.donation_date|timesince }} ago</div>
                    </li>
                    {% endfor %}
                {% else %}
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Welcome to BDIMS</div>
                            <div class="activity-description">Start your donation journey by scheduling your first appointment</div>
                        </div>
                        <div class="activity-time">Just now</div>
                    </li>
                {% endif %}
            </ul>
        </div>
{% endblock %}

{% block extra_js %}
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        // Donation Trends Chart
        const ctx = document.getElementById('donationTrendsChart');
        
        // Get last 6 months data
        const donationData = [
            {% for donation in donation_history reversed %}
            {
                date: '{{ donation.donation_date|date:"Y-m" }}',
                units: {{ donation.units_donated }}
            },
            {% endfor %}
        ];
        
        // Group by month
        const monthlyData = {};
        donationData.forEach(d => {
            if (!monthlyData[d.date]) {
                monthlyData[d.date] = 0;
            }
            monthlyData[d.date] += d.units;
        });
        
        // Get last 6 months
        const months = [];
        const now = new Date();
        for (let i = 5; i >= 0; i--) {
            const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const monthStr = d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            const dateKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
            months.push({
                label: monthStr,
                value: monthlyData[dateKey] || 0
            });
        }
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: months.map(m => m.label),
                datasets: [{
                    label: 'Blood Units Donated',
                    data: months.map(m => m.value),
                    borderColor: '#dc2626',
                    backgroundColor: 'rgba(220, 38, 38, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#dc2626',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14,
                                weight: 600
                            },
                            color: '#374151',
                            padding: 20
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' unit(s) donated';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: {
                                size: 12
                            },
                            color: '#6b7280'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 12
                            },
                            color: '#6b7280'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        
        // Add smooth animations
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.fade-in-up');
            elements.forEach((element, index) => {
                element.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Add hover effects to action cards
        document.querySelectorAll('.action-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Auto-refresh emergency alerts every 30 seconds
        setInterval(function() {
            if (document.querySelector('.emergency-section')) {
                location.reload();
            }
        }, 30000);
    </script>
{% endblock %}
