{% extends 'donor/base_donor.html' %}

{% block title %}Edit Profile - Blood Donor{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        margin-bottom: var(--space-8);
    }
    
    .page-title {
        font-size: var(--text-4xl);
        font-weight: 700;
        color: var(--color-gray-900);
        margin-bottom: var(--space-2);
    }
    
    .page-subtitle {
        color: var(--color-gray-600);
        font-size: var(--text-lg);
    }
    
    .form-container {
        background: white;
        border-radius: var(--radius-lg);
        padding: var(--space-8);
        box-shadow: var(--shadow-sm);
    }
    
    .form-section {
        margin-bottom: var(--space-8);
    }
    
    .form-section:last-child {
        margin-bottom: 0;
    }
    
    .section-title {
        font-size: var(--text-xl);
        font-weight: 600;
        color: var(--color-gray-900);
        margin-bottom: var(--space-6);
        padding-bottom: var(--space-3);
        border-bottom: 2px solid var(--color-gray-200);
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-6);
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-group.full-width {
        grid-column: 1 / -1;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--color-gray-700);
        margin-bottom: var(--space-2);
        font-size: var(--text-sm);
    }
    
    .form-label.required::after {
        content: '*';
        color: var(--color-danger-600);
        margin-left: var(--space-1);
    }
    
    .form-input,
    .form-select,
    .form-textarea {
        padding: var(--space-3);
        border: 1px solid var(--color-gray-300);
        border-radius: var(--radius-md);
        font-size: var(--text-base);
        color: var(--color-gray-900);
        transition: all 0.2s;
    }
    
    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--color-primary-500);
        box-shadow: 0 0 0 3px var(--color-primary-100);
    }
    
    .form-input:disabled,
    .form-input[readonly] {
        background-color: var(--color-gray-100);
        color: var(--color-gray-500);
        cursor: not-allowed;
    }
    
    .form-textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .readonly-notice {
        background: var(--color-gray-50);
        border-left: 4px solid var(--color-gray-400);
        padding: var(--space-4);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-6);
    }
    
    .readonly-notice h4 {
        font-size: var(--text-base);
        font-weight: 600;
        color: var(--color-gray-700);
        margin-bottom: var(--space-2);
    }
    
    .readonly-notice p {
        font-size: var(--text-sm);
        color: var(--color-gray-600);
        margin: 0;
    }
    
    .readonly-info {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3);
        background: var(--color-gray-50);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
    }
    
    .readonly-label {
        font-weight: 600;
        color: var(--color-gray-700);
    }
    
    .readonly-value {
        color: var(--color-gray-900);
    }
    
    .blood-type-badge {
        display: inline-block;
        padding: var(--space-2) var(--space-4);
        background: linear-gradient(135deg, var(--color-danger-600), var(--color-danger-700));
        color: white;
        font-weight: 700;
        border-radius: var(--radius-md);
        font-size: var(--text-lg);
    }
    
    .form-actions {
        display: flex;
        gap: var(--space-4);
        margin-top: var(--space-8);
        padding-top: var(--space-6);
        border-top: 2px solid var(--color-gray-200);
    }
    
    .btn {
        padding: var(--space-3) var(--space-6);
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: var(--text-base);
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-700));
        color: white;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .btn-secondary {
        background: var(--color-gray-100);
        color: var(--color-gray-700);
        border: 1px solid var(--color-gray-300);
    }
    
    .btn-secondary:hover {
        background: var(--color-gray-200);
    }
    
    .help-text {
        font-size: var(--text-sm);
        color: var(--color-gray-500);
        margin-top: var(--space-1);
    }
    
    .error-message {
        color: var(--color-danger-600);
        font-size: var(--text-sm);
        margin-top: var(--space-1);
    }
    
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-container {
            padding: var(--space-6);
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block breadcrumb %}
<nav aria-label="Breadcrumb" class="breadcrumb">
    <ol>
        <li><a href="{% url 'donor:donor_dashboard' %}"><i class="fas fa-home"></i> Dashboard</a></li>
        <li><a href="{% url 'donor:profile' %}">My Profile</a></li>
        <li aria-current="page">Edit Profile</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Edit Profile</h1>
    <p class="page-subtitle">Update your personal information</p>
</div>

<div class="form-container">
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    <form method="post" action="{% url 'donor:edit_profile' %}">
        {% csrf_token %}
        
        <!-- Readonly Information Notice -->
        <div class="readonly-notice">
            <h4><i class="fas fa-info-circle"></i> Read-Only Information</h4>
            <p>Some information like username and blood group cannot be changed. Please contact an administrator if you need to update these details.</p>
        </div>

        <!-- Readonly Fields -->
        <div class="form-section">
            <div class="form-grid">
                <div class="form-group">
                    <div class="readonly-info">
                        <span class="readonly-label">Username:</span>
                        <span class="readonly-value">{{ user.username }}</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="readonly-info">
                        <span class="readonly-label">Blood Group:</span>
                        <span class="blood-type-badge">{{ donor.blood_group }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal Information -->
        <div class="form-section">
            <h2 class="section-title">Personal Information</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="first_name" class="form-label required">First Name</label>
                    <input 
                        type="text" 
                        id="first_name" 
                        name="first_name" 
                        class="form-input"
                        value="{{ user.first_name }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="last_name" class="form-label required">Last Name</label>
                    <input 
                        type="text" 
                        id="last_name" 
                        name="last_name" 
                        class="form-input"
                        value="{{ user.last_name }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="email" class="form-label required">Email Address</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input"
                        value="{{ user.email }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="phone_number" class="form-label required">Phone Number</label>
                    <input 
                        type="tel" 
                        id="phone_number" 
                        name="phone_number" 
                        class="form-input"
                        value="{{ donor.phone_number }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="date_of_birth" class="form-label required">Date of Birth</label>
                    <input 
                        type="date" 
                        id="date_of_birth" 
                        name="date_of_birth" 
                        class="form-input"
                        value="{{ donor.date_of_birth|date:'Y-m-d' }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="gender" class="form-label required">Gender</label>
                    <select id="gender" name="gender" class="form-select" required>
                        <option value="">Select Gender</option>
                        <option value="M" {% if donor.gender == 'M' %}selected{% endif %}>Male</option>
                        <option value="F" {% if donor.gender == 'F' %}selected{% endif %}>Female</option>
                        <option value="O" {% if donor.gender == 'O' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="weight" class="form-label">Weight (kg)</label>
                    <input 
                        type="number" 
                        id="weight" 
                        name="weight" 
                        class="form-input"
                        value="{{ donor.weight }}"
                        step="0.1"
                        min="0"
                    >
                    <span class="help-text">Optional: Your weight in kilograms</span>
                </div>
            </div>
        </div>

        <!-- Location Information -->
        <div class="form-section">
            <h2 class="section-title">Location Information</h2>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="address" class="form-label">Address</label>
                    <input 
                        type="text" 
                        id="address" 
                        name="address" 
                        class="form-input"
                        value="{{ donor.address }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="city" class="form-label">City</label>
                    <input 
                        type="text" 
                        id="city" 
                        name="city" 
                        class="form-input"
                        value="{{ donor.city }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="state" class="form-label">State/Province</label>
                    <input 
                        type="text" 
                        id="state" 
                        name="state" 
                        class="form-input"
                        value="{{ donor.state }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="postal_code" class="form-label">Postal Code</label>
                    <input 
                        type="text" 
                        id="postal_code" 
                        name="postal_code" 
                        class="form-input"
                        value="{{ donor.postal_code }}"
                    >
                </div>
                
                <div class="form-group">
                    <label for="country" class="form-label">Country</label>
                    <input 
                        type="text" 
                        id="country" 
                        name="country" 
                        class="form-input"
                        value="{{ donor.country }}"
                    >
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Changes
            </button>
            <a href="{% url 'donor:profile' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>

    <!-- Change Password Section -->
    <div class="form-section" style="margin-top: var(--space-8);">
        <div class="section-header">
            <h3 class="section-title">
                <i class="fas fa-lock"></i>
                Change Password
            </h3>
            <p class="section-description">Update your account password for security</p>
        </div>
        <form method="POST" action="{% url 'donor:change_password' %}" class="profile-form">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="old_password" class="form-label">Current Password <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="old_password" 
                        name="old_password" 
                        class="form-input"
                        placeholder="Enter current password"
                        required
                    >
                    <small class="form-text">Enter your current password to verify your identity</small>
                </div>
                <div class="form-group">
                    <label for="new_password1" class="form-label">New Password <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="new_password1" 
                        name="new_password1" 
                        class="form-input"
                        placeholder="Enter new password"
                        required
                    >
                    <small class="form-text">Password must be at least 8 characters long</small>
                </div>
                <div class="form-group">
                    <label for="new_password2" class="form-label">Confirm New Password <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="new_password2" 
                        name="new_password2" 
                        class="form-input"
                        placeholder="Confirm new password"
                        required
                    >
                    <small class="form-text">Re-enter your new password to confirm</small>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-key"></i> Change Password
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
